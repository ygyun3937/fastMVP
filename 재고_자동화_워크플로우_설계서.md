# 📋 프로젝트 수주 시 재고 현황 자동화 워크플로우 설계서

## 📊 시스템 개요

새로운 프로젝트가 수주될 때 자동으로 필요한 장비의 재고를 확인하고, 부족한 품목이 있을 경우 담당자에게 알림을 보내는 자동화 시스템입니다.

---

## 🎯 주요 기능

1. **프로젝트 정보 입력** - 폼 또는 구글 시트로 신규 프로젝트 등록
2. **재고 자동 조회** - 필요 장비의 현재 재고 확인
3. **재고 부족 감지** - 필요수량 vs 현재수량 비교
4. **자동 알림 발송** - 부족 품목 발생 시 담당자에게 이메일/슬랙 알림
5. **재고 현황 리포트** - 프로젝트별 재고 현황 요약 자동 생성

---

## 🔄 워크플로우 구조

### Flow 1: 프로젝트 수주 등록 및 재고 확인

```
[프로젝트 정보 입력]
       ↓
[구글 시트에 프로젝트 등록]
       ↓
[필요 장비 정보 입력]
       ↓
[재고 시트 조회]
       ↓
[재고 vs 필요수량 비교]
       ↓
[부족 여부 판단]
       ↓
    ┌──┴──┐
    ↓     ↓
[충분]  [부족]
    ↓     ↓
 [완료] [담당자 알림]
         ↓
    [재고 리포트 생성]
```

---

## 📝 n8n 워크플로우 상세 설계

### 1️⃣ Trigger: Form 입력 또는 Google Sheets 감시

**옵션 A: Form Trigger 사용**
```
노드: Form Trigger
입력 필드:
- project_id (텍스트)
- project_name (텍스트)
- client (텍스트)
- start_date (날짜)
- manager (텍스트)
```

**옵션 B: Google Sheets Trigger 사용**
```
노드: Google Sheets Trigger
시트: "프로젝트목록"
감시: 새 행 추가
```

---

### 2️⃣ 프로젝트 정보를 Google Sheets에 저장

```
노드: Google Sheets (Append)
시트명: "프로젝트목록"
데이터:
- 프로젝트ID: {{$json.project_id}}
- 프로젝트명: {{$json.project_name}}
- 고객사: {{$json.client}}
- 수주일: {{$now.format('YYYY-MM-DD')}}
- 상태: "진행중"
- 담당자: {{$json.manager}}
```

---

### 3️⃣ 필요 장비 정보 입력

```
노드: Form Trigger (또는 별도 입력)
반복 입력:
- equipment_code (품목코드)
- equipment_name (품목명)
- required_qty (필요수량)
```

또는

```
노드: Code Node
입력: 장비 리스트 배열
[
  {code: "EQ-001", name: "노트북", qty: 15},
  {code: "EQ-002", name: "프로젝터", qty: 3},
  {code: "EQ-003", name: "마이크", qty: 5}
]
```

---

### 4️⃣ 재고 시트에서 현재 재고 조회

```
노드: Google Sheets (Lookup)
시트명: "장비재고"
조회 조건: 품목코드 = {{$json.equipment_code}}
반환 값: 현재수량, 최소수량, 담당자
```

---

### 5️⃣ 재고 부족 여부 계산

```
노드: Code Node
JavaScript:
const required = $json.required_qty;
const current = $json.current_qty;
const shortage = Math.max(0, required - current);

return {
  ...item,
  shortage: shortage,
  status: shortage > 0 ? "부족" : "충분"
};
```

---

### 6️⃣ 조건 분기: 재고 부족 여부

```
노드: IF Node
조건: {{$json.shortage}} > 0
True → 담당자 알림 발송
False → 종료
```

---

### 7️⃣ 담당자 알림 발송 (재고 부족 시)

**옵션 A: 이메일 알림**
```
노드: Send Email (Gmail)
수신자: {{$json.담당자_이메일}}
제목: [재고 부족 알림] {{$json.project_name}} - {{$json.equipment_name}}
본문:
프로젝트: {{$json.project_name}}
고객사: {{$json.client}}

재고 부족 품목:
- 품목명: {{$json.equipment_name}}
- 품목코드: {{$json.equipment_code}}
- 필요수량: {{$json.required_qty}}
- 현재재고: {{$json.current_qty}}
- 부족수량: {{$json.shortage}}

담당자: {{$json.manager}}
확인 부탁드립니다.
```

**옵션 B: Slack 알림**
```
노드: Slack (Send Message)
채널: #재고관리
메시지:
⚠️ 재고 부족 알림

프로젝트: {{$json.project_name}}
품목: {{$json.equipment_name}} ({{$json.equipment_code}})
부족 수량: {{$json.shortage}}개

@{{$json.manager}} 확인 부탁드립니다.
```

---

### 8️⃣ 프로젝트별 필요장비 시트에 기록

```
노드: Google Sheets (Append)
시트명: "프로젝트별필요장비"
데이터:
- 프로젝트ID: {{$json.project_id}}
- 품목코드: {{$json.equipment_code}}
- 품목명: {{$json.equipment_name}}
- 필요수량: {{$json.required_qty}}
- 할당수량: {{Math.min($json.current_qty, $json.required_qty)}}
- 재고부족수량: {{$json.shortage}}
- 상태: {{$json.status}}
- 비고: {{$json.shortage > 0 ? "추가 발주 필요" : ""}}
```

---

### 9️⃣ 재고 현황 리포트 생성 (선택사항)

```
노드: Code Node
모든 장비 정보를 집계하여 요약 리포트 생성

출력 예시:
{
  project_name: "구씨 마케팅 교육",
  total_items: 8,
  sufficient_items: 5,
  shortage_items: 3,
  shortage_list: [
    {item: "노트북", shortage: 5},
    {item: "HDMI케이블", shortage: 2}
  ]
}
```

```
노드: Send Email
제목: [재고 현황 리포트] {{$json.project_name}}
본문: 자동 생성된 리포트
```

---

## 🛠️ 구현 단계

### Step 1: 구글 시트 업로드
- `장비재고_리스트.xlsx`를 구글 드라이브에 업로드
- `프로젝트_관리.xlsx`를 구글 드라이브에 업로드

### Step 2: n8n 워크플로우 생성
1. n8n에서 새 워크플로우 생성
2. Form Trigger 또는 Google Sheets Trigger 추가
3. Google Sheets 노드 연결 (구글 계정 인증 필요)
4. Code 노드로 재고 부족 계산 로직 추가
5. IF 노드로 조건 분기
6. Email/Slack 노드로 알림 설정

### Step 3: 테스트
1. 샘플 프로젝트 입력
2. 재고 조회 확인
3. 알림 발송 확인
4. 시트 기록 확인

### Step 4: 운영
- 실제 프로젝트 수주 시 워크플로우 실행
- 정기적으로 재고 현황 확인

---

## 📌 추가 개선 아이디어

1. **자동 발주 시스템**
   - 재고가 최소수량 이하일 때 자동으로 발주 요청 생성

2. **재고 이력 관리**
   - 입고/출고 이력을 별도 시트에 기록

3. **대시보드 연동**
   - Google Data Studio 또는 Looker로 실시간 재고 대시보드 구축

4. **QR 코드 재고 관리**
   - 장비에 QR 코드 부착하여 입출고 시 자동 스캔

5. **예측 분석**
   - 과거 프로젝트 데이터를 분석하여 필요 장비 예측

---

## 🎓 사용 가이드

### 새 프로젝트 등록 시
1. n8n Form 또는 구글 시트에 프로젝트 정보 입력
2. 필요 장비 목록과 수량 입력
3. 자동으로 재고 확인 및 알림 발송됨
4. "프로젝트별필요장비" 시트에서 현황 확인

### 재고 부족 알림 받았을 때
1. 이메일/슬랙 알림 확인
2. 재고 시트에서 상세 정보 확인
3. 필요시 추가 발주 진행
4. 프로젝트 시트의 상태 업데이트

---

## ⚙️ 기술 스택

- **n8n**: 워크플로우 자동화 플랫폼
- **Google Sheets**: 데이터 저장소
- **Gmail/Slack**: 알림 채널
- **JavaScript**: 재고 계산 로직

---

## 📞 문의사항

워크플로우 관련 문의나 개선 요청은 담당자에게 연락 바랍니다.
