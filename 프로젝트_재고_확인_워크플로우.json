{
  "name": "í”„ë¡œì íŠ¸ ìˆ˜ì£¼ ì¬ê³  í™•ì¸ ìë™í™”",
  "nodes": [
    {
      "parameters": {
        "formTitle": "ì‹ ê·œ í”„ë¡œì íŠ¸ ì¥ë¹„ ìš”ì²­",
        "formDescription": "ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ìˆ˜ì£¼ ì‹œ í•„ìš”í•œ ì¥ë¹„ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì¬ê³ ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.",
        "formFields": {
          "values": [
            {
              "fieldLabel": "í”„ë¡œì íŠ¸ID",
              "fieldType": "text",
              "requiredField": true,
              "placeholder": "ì˜ˆ: PRJ-2025-001"
            },
            {
              "fieldLabel": "í”„ë¡œì íŠ¸ëª…",
              "fieldType": "text",
              "requiredField": true,
              "placeholder": "ì˜ˆ: êµ¬ì”¨ ë§ˆì¼€íŒ… êµìœ¡"
            },
            {
              "fieldLabel": "ê³ ê°ì‚¬",
              "fieldType": "text",
              "requiredField": true,
              "placeholder": "ì˜ˆ: êµ¬ì”¨ ë§ˆì¼€íŒ…"
            },
            {
              "fieldLabel": "ë‹´ë‹¹ì",
              "fieldType": "text",
              "requiredField": true,
              "placeholder": "ì˜ˆ: ê¹€ë‹´ë‹¹"
            },
            {
              "fieldLabel": "ë‹´ë‹¹ìì´ë©”ì¼",
              "fieldType": "email",
              "requiredField": true,
              "placeholder": "manager@company.com"
            },
            {
              "fieldLabel": "í•„ìš”ì¥ë¹„ëª©ë¡",
              "fieldType": "textarea",
              "requiredField": true,
              "placeholder": "í’ˆëª©ì½”ë“œ,ìˆ˜ëŸ‰ í˜•ì‹ìœ¼ë¡œ ì…ë ¥\nì˜ˆ:\nEQ-001,15\nEQ-002,3\nEQ-003,5"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2,
      "position": [250, 300],
      "id": "form-trigger-001",
      "name": "í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥"
    },
    {
      "parameters": {
        "jsCode": "// í•„ìš”ì¥ë¹„ëª©ë¡ í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±í•˜ì—¬ ë°°ì—´ë¡œ ë³€í™˜\nconst equipmentText = $input.item.json['í•„ìš”ì¥ë¹„ëª©ë¡'];\nconst lines = equipmentText.split('\\n').filter(line => line.trim());\n\nconst equipmentList = lines.map(line => {\n  const [code, qty] = line.split(',').map(s => s.trim());\n  return {\n    equipment_code: code,\n    required_qty: parseInt(qty)\n  };\n});\n\n// í”„ë¡œì íŠ¸ ê¸°ë³¸ ì •ë³´\nconst projectInfo = {\n  project_id: $input.item.json['í”„ë¡œì íŠ¸ID'],\n  project_name: $input.item.json['í”„ë¡œì íŠ¸ëª…'],\n  client: $input.item.json['ê³ ê°ì‚¬'],\n  manager: $input.item.json['ë‹´ë‹¹ì'],\n  manager_email: $input.item.json['ë‹´ë‹¹ìì´ë©”ì¼'],\n  order_date: new Date().toISOString().split('T')[0]\n};\n\n// ê° ì¥ë¹„ì— í”„ë¡œì íŠ¸ ì •ë³´ ì¶”ê°€\nreturn equipmentList.map(eq => ({\n  json: {\n    ...projectInfo,\n    ...eq\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300],
      "id": "parse-equipment-001",
      "name": "ì¥ë¹„ëª©ë¡ íŒŒì‹±"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": "YOUR_PROJECT_SHEET_ID",
        "sheetName": "í”„ë¡œì íŠ¸ëª©ë¡",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "í”„ë¡œì íŠ¸ID": "={{ $json.project_id }}",
            "í”„ë¡œì íŠ¸ëª…": "={{ $json.project_name }}",
            "ê³ ê°ì‚¬": "={{ $json.client }}",
            "ìˆ˜ì£¼ì¼": "={{ $json.order_date }}",
            "ìƒíƒœ": "ì§„í–‰ì¤‘",
            "ë‹´ë‹¹ì": "={{ $json.manager }}"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [650, 200],
      "id": "save-project-001",
      "name": "í”„ë¡œì íŠ¸ ì •ë³´ ì €ì¥"
    },
    {
      "parameters": {
        "operation": "lookup",
        "documentId": "YOUR_INVENTORY_SHEET_ID",
        "sheetName": "ì¥ë¹„ì¬ê³ ",
        "lookupColumn": "í’ˆëª©ì½”ë“œ",
        "lookupValue": "={{ $json.equipment_code }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [650, 400],
      "id": "lookup-inventory-001",
      "name": "ì¬ê³  ì¡°íšŒ"
    },
    {
      "parameters": {
        "jsCode": "// ì¬ê³  ë¶€ì¡± ê³„ì‚°\nconst required = $input.item.json.required_qty;\nconst current = parseInt($input.item.json['í˜„ì¬ìˆ˜ëŸ‰']) || 0;\nconst minQty = parseInt($input.item.json['ìµœì†Œìˆ˜ëŸ‰']) || 0;\nconst equipmentName = $input.item.json['í’ˆëª©ëª…'];\nconst manager = $input.item.json['ë‹´ë‹¹ì'];\n\nconst shortage = Math.max(0, required - current);\nconst allocated = Math.min(required, current);\nconst status = shortage > 0 ? 'ë¶€ì¡±' : 'ì¶©ë¶„';\n\nreturn {\n  json: {\n    ...$input.item.json,\n    equipment_name: equipmentName,\n    current_qty: current,\n    min_qty: minQty,\n    allocated_qty: allocated,\n    shortage_qty: shortage,\n    status: status,\n    equipment_manager: manager,\n    alert_needed: shortage > 0\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 400],
      "id": "calc-shortage-001",
      "name": "ì¬ê³  ë¶€ì¡± ê³„ì‚°"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": "YOUR_PROJECT_SHEET_ID",
        "sheetName": "í”„ë¡œì íŠ¸ë³„í•„ìš”ì¥ë¹„",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "í”„ë¡œì íŠ¸ID": "={{ $json.project_id }}",
            "í’ˆëª©ì½”ë“œ": "={{ $json.equipment_code }}",
            "í’ˆëª©ëª…": "={{ $json.equipment_name }}",
            "í•„ìš”ìˆ˜ëŸ‰": "={{ $json.required_qty }}",
            "í• ë‹¹ìˆ˜ëŸ‰": "={{ $json.allocated_qty }}",
            "ì¬ê³ ë¶€ì¡±ìˆ˜ëŸ‰": "={{ $json.shortage_qty }}",
            "ìƒíƒœ": "={{ $json.status }}",
            "ë¹„ê³ ": "={{ $json.shortage_qty > 0 ? 'ì¶”ê°€ ë°œì£¼ í•„ìš”' : '' }}"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1050, 400],
      "id": "save-equipment-001",
      "name": "ì¥ë¹„ í˜„í™© ì €ì¥"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.alert_needed }}",
              "value2": true
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1250, 400],
      "id": "check-shortage-001",
      "name": "ì¬ê³  ë¶€ì¡± í™•ì¸"
    },
    {
      "parameters": {
        "functionCode": "// ëª¨ë“  ë¶€ì¡± í’ˆëª© ì§‘ê³„\nconst items = $input.all();\nconst shortageItems = items.filter(item => item.json.shortage_qty > 0);\n\nif (shortageItems.length === 0) {\n  return [];\n}\n\nconst projectInfo = items[0].json;\n\n// ë¶€ì¡± í’ˆëª© ë¦¬ìŠ¤íŠ¸ ìƒì„±\nconst shortageList = shortageItems.map(item => \n  `â€¢ ${item.json.equipment_name} (${item.json.equipment_code}): í•„ìš” ${item.json.required_qty}ê°œ, ì¬ê³  ${item.json.current_qty}ê°œ, ë¶€ì¡± ${item.json.shortage_qty}ê°œ`\n).join('\\n');\n\nreturn [{\n  json: {\n    project_id: projectInfo.project_id,\n    project_name: projectInfo.project_name,\n    client: projectInfo.client,\n    manager_email: projectInfo.manager_email,\n    manager: projectInfo.manager,\n    shortage_count: shortageItems.length,\n    shortage_list: shortageList,\n    total_items: items.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1450, 300],
      "id": "aggregate-shortage-001",
      "name": "ë¶€ì¡± í’ˆëª© ì§‘ê³„"
    },
    {
      "parameters": {
        "fromEmail": "noreply@yourcompany.com",
        "toEmail": "={{ $json.manager_email }}",
        "subject": "âš ï¸ [ì¬ê³  ë¶€ì¡± ì•Œë¦¼] {{ $json.project_name }}",
        "emailType": "html",
        "message": "<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; }\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n    .header { background-color: #ff6b6b; color: white; padding: 15px; border-radius: 5px; }\n    .content { background-color: #f8f9fa; padding: 20px; margin-top: 20px; border-radius: 5px; }\n    .item-list { background-color: white; padding: 15px; margin: 10px 0; border-left: 4px solid #ff6b6b; }\n    .footer { margin-top: 20px; font-size: 12px; color: #666; }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <h2>âš ï¸ ì¬ê³  ë¶€ì¡± ì•Œë¦¼</h2>\n    </div>\n    \n    <div class=\"content\">\n      <h3>í”„ë¡œì íŠ¸ ì •ë³´</h3>\n      <p>\n        <strong>í”„ë¡œì íŠ¸ëª…:</strong> {{ $json.project_name }}<br>\n        <strong>ê³ ê°ì‚¬:</strong> {{ $json.client }}<br>\n        <strong>í”„ë¡œì íŠ¸ID:</strong> {{ $json.project_id }}<br>\n        <strong>ë‹´ë‹¹ì:</strong> {{ $json.manager }}\n      </p>\n      \n      <h3>ì¬ê³  ë¶€ì¡± í˜„í™©</h3>\n      <p><strong>ë¶€ì¡± í’ˆëª© ìˆ˜:</strong> {{ $json.shortage_count }}ê°œ / ì´ {{ $json.total_items }}ê°œ</p>\n      \n      <div class=\"item-list\">\n        <h4>ë¶€ì¡± í’ˆëª© ìƒì„¸:</h4>\n        <pre>{{ $json.shortage_list }}</pre>\n      </div>\n      \n      <p style=\"color: #ff6b6b; font-weight: bold;\">\n        ğŸ“Œ ì¶”ê°€ ë°œì£¼ ë˜ëŠ” ëŒ€ì²´ ì¥ë¹„ í™•ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n      </p>\n    </div>\n    \n    <div class=\"footer\">\n      <p>ì´ ë©”ì¼ì€ ìë™ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>\n    </div>\n  </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [1650, 300],
      "id": "send-email-001",
      "name": "ë‹´ë‹¹ì ì´ë©”ì¼ ì•Œë¦¼"
    }
  ],
  "connections": {
    "í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥": {
      "main": [
        [
          {
            "node": "ì¥ë¹„ëª©ë¡ íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¥ë¹„ëª©ë¡ íŒŒì‹±": {
      "main": [
        [
          {
            "node": "í”„ë¡œì íŠ¸ ì •ë³´ ì €ì¥",
            "type": "main",
            "index": 0
          },
          {
            "node": "ì¬ê³  ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¬ê³  ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ì¬ê³  ë¶€ì¡± ê³„ì‚°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¬ê³  ë¶€ì¡± ê³„ì‚°": {
      "main": [
        [
          {
            "node": "ì¥ë¹„ í˜„í™© ì €ì¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¥ë¹„ í˜„í™© ì €ì¥": {
      "main": [
        [
          {
            "node": "ì¬ê³  ë¶€ì¡± í™•ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¬ê³  ë¶€ì¡± í™•ì¸": {
      "main": [
        [
          {
            "node": "ë¶€ì¡± í’ˆëª© ì§‘ê³„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë¶€ì¡± í’ˆëª© ì§‘ê³„": {
      "main": [
        [
          {
            "node": "ë‹´ë‹¹ì ì´ë©”ì¼ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  }
}
